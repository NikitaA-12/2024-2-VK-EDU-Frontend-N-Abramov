(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))n(o);new MutationObserver(o=>{for(const a of o)if(a.type==="childList")for(const i of a.addedNodes)i.tagName==="LINK"&&i.rel==="modulepreload"&&n(i)}).observe(document,{childList:!0,subtree:!0});function s(o){const a={};return o.integrity&&(a.integrity=o.integrity),o.referrerPolicy&&(a.referrerPolicy=o.referrerPolicy),o.crossOrigin==="use-credentials"?a.credentials="include":o.crossOrigin==="anonymous"?a.credentials="omit":a.credentials="same-origin",a}function n(o){if(o.ep)return;o.ep=!0;const a=s(o);fetch(o.href,a)}})();const x=document.querySelector(".chatBox"),l=document.querySelector("#chatAvatar"),y=document.querySelector("#chatName"),L=document.getElementById("messageBox");let h=null;function B(t){const e=document.createElement("div");e.classList.add("block");const s=t.participants[0].charAt(0).toUpperCase(),n=t.messages.length?C(t.messages[t.messages.length-1].time):"",o=t.messages.length?t.messages[t.messages.length-1].content:"Нет сообщений",a='<span class="material-icons read-icon" style="margin-left: 5px;">done_all</span>';return e.innerHTML=`
      <div class="imgBx">
        <img 
          id="chatAvatar${t.chatId}" 
          src="/${t.chatId}.png" 
          alt="Chat avatar" 
          onerror="this.style.display='none'; this.nextElementSibling.style.display='flex';" 
        />
        <div class="avatarLetter" style="display: none; justify-content: center; align-items: center; font-size: 24px; width: 40px; height: 40px; border-radius: 50%; background-color: #8f9efe;">
          ${s}
        </div>
      </div>
      <div class="details">
        <div class="listHead">
          <h4>${t.participants[0]}</h4>
          <div class="time-delete-wrapper">
            <span class="material-symbols-outlined delete-chat" data-chat-id="${t.chatId}">delete</span> <!-- Иконка удаления -->
            <p class="time">${n}</p>
          </div>
        </div>
        <div class="message_p" style="display: flex; justify-content: space-between; align-items: center;">
          <p>${o}</p>
          ${a}
        </div>
      </div>`,e.addEventListener("click",()=>D(t)),e}function A(t,e,s){const n=`/${t}.png`,o=s.innerHTML.charAt(0).toUpperCase();e.src=n,e.onload=()=>{e.style.display="block",e.nextElementSibling.style.display="none"},e.onerror=()=>{e.style.display="none";const a=e.nextElementSibling;a.style.display="flex",a.innerHTML=o}}function D(t){x.classList.remove("hide"),L.innerHTML="",h=t.chatId,y.innerHTML=`${t.participants[0]} <br /><span>online</span>`;const e=t.participants[0].charAt(0).toUpperCase();A(t.chatId,l,y),l.onerror=()=>{l.nextElementSibling.style.display="flex",l.nextElementSibling.innerHTML=e},t.messages.forEach(s=>{const n=document.createElement("div");s.type==="incoming"?n.classList.add("message","incoming"):s.type==="outgoing"&&n.classList.add("message","outgoing");const o=C(s.time);n.innerHTML=`
      <p>${s.content}</p>
      <div class="message-footer">
        <span class="time">${o}</span>
        <span class="material-icons read-icon">done_all</span> <!-- Иконка прочтения -->
      </div>
    `,L.appendChild(n)})}function C(t){return new Date(t).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})}const c={chats:[{chatId:1,participants:["You","right"],messages:[{type:"incoming",from:"You",content:"Hey, how's it going?",time:"2024-10-15T10:00"},{type:"outgoing",from:"right",content:"All good, thanks! How about you?",time:"2024-10-15T10:05"},{type:"incoming",from:"You",content:"I'm doing well, thanks for asking!",time:"2024-10-15T10:10"}]},{chatId:2,participants:["Jane Smith","right"],messages:[{type:"outgoing",from:"right",content:"Hey Jane, let's catch up soon!",time:"2024-10-15T12:30"},{type:"incoming",from:"Jane Smith",content:"Sure! How about tomorrow?",time:"2024-10-15T12:35"},{type:"outgoing",from:"right",content:"Sounds good. Let's meet at 10 AM.",time:"2024-10-15T12:40"}]}]};function r(){try{localStorage.setItem("chatData",JSON.stringify(c)),console.log("Чаты успешно сохранены в localStorage.")}catch(t){console.error("Ошибка при сохранении чатов в localStorage:",t)}}function E(){try{const t=localStorage.getItem("chatData");t&&(c.chats=JSON.parse(t).chats),console.log("Чаты успешно загружены из localStorage.")}catch(t){console.error("Ошибка при загрузке чатов из localStorage:",t)}}function $(){c.chats.sort((t,e)=>{const s=t.messages.length?new Date(t.messages[t.messages.length-1].time):new Date(0);return(e.messages.length?new Date(e.messages[e.messages.length-1].time):new Date(0))-s})}const v=document.querySelector(".chatlist");E();$();d();function d(){v.innerHTML="",c.chats.forEach(e=>{const s=B(e);v.appendChild(s)}),document.querySelectorAll(".delete-chat").forEach(e=>{e.addEventListener("click",s=>{s.stopPropagation();const n=parseInt(e.getAttribute("data-chat-id"));b(n)})})}function b(t){c.chats=c.chats.filter(e=>e.chatId!==t),r(),d()}d();r();document.addEventListener("DOMContentLoaded",()=>{const t=document.querySelector(".material-symbols-outlined"),e=document.querySelector("#searchInput"),s=document.querySelectorAll(".chatlist .block");function n(){t.classList.add("hide"),e.classList.add("active"),e.focus()}function o(){const a=e.value.toLowerCase();s.forEach(i=>{const w=i.querySelector(".listHead h4").innerText.toLowerCase();i.style.display=w.includes(a)?"":"none"})}t.addEventListener("click",n),e.addEventListener("input",o),e.addEventListener("blur",()=>{e.value===""&&(t.classList.remove("hide"),e.classList.remove("active"))}),e.addEventListener("focus",()=>{t.classList.add("hide")})});const p=document.getElementById("chatNameInput"),H=document.getElementById("createChatButton"),M=document.getElementById("chatModal");function k(){const t=p.value.trim();if(t!==""){const e=new Date;new Intl.DateTimeFormat("ru-RU",{timeZone:"Europe/Moscow",hour:"2-digit",minute:"2-digit"}).format(e);const s={chatId:c.chats.length+1,participants:[t,"right"],messages:[]};c.chats.unshift(s),r(),p.value="",d(),T()}}H.addEventListener("click",k);const q=document.getElementById("modalClose");function N(){M.classList.add("active")}function T(){p.value="",M.classList.remove("active")}q.addEventListener("click",T);document.getElementById("openModalButton").addEventListener("click",N);function O(){c.chats.sort((t,e)=>{const s=t.messages.length?new Date(t.messages[t.messages.length-1].time):new Date(0);return(e.messages.length?new Date(e.messages[e.messages.length-1].time):new Date(0))-s})}const S=document.querySelector(".chatlist");E();O();g();function g(){S.innerHTML="",c.chats.forEach(e=>{const s=B(e);S.appendChild(s)}),document.querySelectorAll(".delete-chat").forEach(e=>{e.addEventListener("click",s=>{s.stopPropagation();const n=parseInt(e.getAttribute("data-chat-id"));P(n)})})}function P(t){c.chats=c.chats.filter(e=>e.chatId!==t),r(),g()}g();r();const m=document.getElementById("messageBox"),J=document.querySelector(".chatBox"),U=document.querySelector("#back"),F=document.querySelector("#send-btn"),I=document.querySelector("#messageInput");let f="right";F.addEventListener("click",()=>{console.log("sendBtn clicked");const t=I.value.trim();if(console.log("messageContent",t),t&&h!==null){const e={type:f==="right"?"outgoing":"incoming",from:f,content:t,time:new Date().toISOString()},s=c.chats.find(n=>n.chatId===h);if(s){s.messages.push(e);const n=document.createElement("div");n.classList.add("message","outgoing");const o=new Date(e.time).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"});n.innerHTML=`<p>${t}</p><span class="time">${o}</span>`,m.appendChild(n),m.scrollTop=m.scrollHeight,I.value="",r()}}});U.addEventListener("click",()=>{J.classList.add("hide"),g()});const R=document.getElementById("toggleAlignment");let u=!0;function Y(){document.querySelectorAll(".message").forEach(e=>{e.classList.contains("incoming")?(e.classList.remove("incoming"),e.classList.add("outgoing"),e.style.textAlign="right",e.style.marginLeft="auto",e.style.marginRight="unset"):e.classList.contains("outgoing")&&(e.classList.remove("outgoing"),e.classList.add("incoming"),e.style.textAlign="left",e.style.marginRight="auto",e.style.marginLeft="unset")}),f=u?"left":"right",u=!u}R.addEventListener("click",Y);

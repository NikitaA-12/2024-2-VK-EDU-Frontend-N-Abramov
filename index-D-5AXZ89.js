(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))a(n);new MutationObserver(n=>{for(const o of n)if(o.type==="childList")for(const i of o.addedNodes)i.tagName==="LINK"&&i.rel==="modulepreload"&&a(i)}).observe(document,{childList:!0,subtree:!0});function s(n){const o={};return n.integrity&&(o.integrity=n.integrity),n.referrerPolicy&&(o.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?o.credentials="include":n.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function a(n){if(n.ep)return;n.ep=!0;const o=s(n);fetch(n.href,o)}})();const D=document.querySelector(".chatBox"),l=document.querySelector("#chatAvatar"),L=document.querySelector("#chatName"),v=document.getElementById("messageBox");let d=null;function E(t){const e=document.createElement("div");e.classList.add("block");const s=t.participants[0].charAt(0).toUpperCase(),a=t.messages.length?B(t.messages[t.messages.length-1].time):"",n=t.messages.length?t.messages[t.messages.length-1].content:"Нет сообщений",o='<span class="material-icons read-icon" style="margin-left: 5px;">done_all</span>';return e.innerHTML=`
      <div class="imgBx">
        <img 
          id="chatAvatar${t.chatId}" 
          src="${t.chatId}.png" 
          alt="Chat avatar" 
          onerror="this.style.display='none'; this.nextElementSibling.style.display='flex';" 
        />
        <div class="avatarLetter" style="display: none; justify-content: center; align-items: center; font-size: 24px; width: 40px; height: 40px; border-radius: 50%; background-color: #8f9efe;">
          ${s}
        </div>
      </div>
      <div class="details">
        <div class="listHead">
          <h4>${t.participants[0]}</h4>
          <div class="time-delete-wrapper">
            <span class="material-symbols-outlined delete-chat" data-chat-id="${t.chatId}">delete</span> <!-- Иконка удаления -->
            <p class="time">${a}</p>
          </div>
        </div>
        <div class="message_p" style="display: flex; justify-content: space-between; align-items: center;">
          <p>${n}</p>
          ${o}
        </div>
      </div>`,e.addEventListener("click",()=>H(t)),e}function k(t,e,s){const a=`${t}.png`,n=s.innerHTML.charAt(0).toUpperCase();e.src=a,e.onload=()=>{e.style.display="block",e.nextElementSibling.style.display="none"},e.onerror=()=>{e.style.display="none";const o=e.nextElementSibling;o.style.display="flex",o.innerHTML=n}}function H(t){D.classList.remove("hide"),v.innerHTML="",d=t.chatId,L.innerHTML=`${t.participants[0]} <br /><span>online</span>`;const e=t.participants[0].charAt(0).toUpperCase();k(t.chatId,l,L),l.onerror=()=>{l.nextElementSibling.style.display="flex",l.nextElementSibling.innerHTML=e},t.messages.forEach(s=>{const a=document.createElement("div");s.type==="incoming"?a.classList.add("message","incoming"):s.type==="outgoing"&&a.classList.add("message","outgoing");const n=B(s.time);a.innerHTML=`
      <p>${s.content}</p>
      <div class="message-footer">
        <span class="time">${n}</span>
        <span class="material-icons read-icon">done_all</span> <!-- Иконка прочтения -->
      </div>
    `,v.appendChild(a)})}function B(t){return new Date(t).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})}const c={chats:[{chatId:1,participants:["You","right"],messages:[{type:"incoming",from:"You",content:"Hey, how's it going?",time:"2024-10-15T10:00"},{type:"outgoing",from:"right",content:"All good, thanks! How about you?",time:"2024-10-15T10:05"},{type:"incoming",from:"You",content:"I'm doing well, thanks for asking!",time:"2024-10-15T10:10"}]},{chatId:2,participants:["Jane Smith","right"],messages:[{type:"outgoing",from:"right",content:"Hey Jane, let's catch up soon!",time:"2024-10-15T12:30"},{type:"incoming",from:"Jane Smith",content:"Sure! How about tomorrow?",time:"2024-10-15T12:35"},{type:"outgoing",from:"right",content:"Sounds good. Let's meet at 10 AM.",time:"2024-10-15T12:40"}]}]};function r(){try{localStorage.setItem("chatData",JSON.stringify(c)),console.log("Чаты успешно сохранены в localStorage.")}catch(t){console.error("Ошибка при сохранении чатов в localStorage:",t)}}function C(){try{const t=localStorage.getItem("chatData");t&&(c.chats=JSON.parse(t).chats),console.log("Чаты успешно загружены из localStorage.")}catch(t){console.error("Ошибка при загрузке чатов из localStorage:",t)}}function $(){c.chats.sort((t,e)=>{const s=t.messages.length?new Date(t.messages[t.messages.length-1].time):new Date(0);return(e.messages.length?new Date(e.messages[e.messages.length-1].time):new Date(0))-s})}const S=document.querySelector(".chatlist");C();$();m();function m(){S.innerHTML="",c.chats.forEach(e=>{const s=E(e);S.appendChild(s)}),document.querySelectorAll(".delete-chat").forEach(e=>{e.addEventListener("click",s=>{s.stopPropagation();const a=parseInt(e.getAttribute("data-chat-id"));b(a)})})}function b(t){c.chats=c.chats.filter(e=>e.chatId!==t),r(),m()}m();r();document.addEventListener("DOMContentLoaded",()=>{const t=document.querySelector(".material-symbols-outlined"),e=document.querySelector("#searchInput"),s=document.querySelectorAll(".chatlist .block");function a(){t.classList.add("hide"),e.classList.add("active"),e.focus()}function n(){const o=e.value.toLowerCase();s.forEach(i=>{const A=i.querySelector(".listHead h4").innerText.toLowerCase();i.style.display=A.includes(o)?"":"none"})}t.addEventListener("click",a),e.addEventListener("input",n),e.addEventListener("blur",()=>{e.value===""&&(t.classList.remove("hide"),e.classList.remove("active"))}),e.addEventListener("focus",()=>{t.classList.add("hide")})});const g=document.getElementById("chatNameInput"),q=document.getElementById("createChatButton"),M=document.getElementById("chatModal");function T(){let t=g.value.trim();if(t!==""){t=P(t);const e=new Date;new Intl.DateTimeFormat("ru-RU",{timeZone:"Europe/Moscow",hour:"2-digit",minute:"2-digit"}).format(e);const s={chatId:c.chats.length+1,participants:[t,"right"],messages:[]};c.chats.unshift(s),r(),g.value="",m(),w()}}q.addEventListener("click",T);const N=document.getElementById("modalClose");function O(){M.classList.add("active")}function w(){g.value="",M.classList.remove("active")}N.addEventListener("click",w);document.getElementById("openModalButton").addEventListener("click",O);function P(t){return t.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#039;")}g.addEventListener("keypress",t=>{t.key==="Enter"&&T()});function J(){c.chats.sort((t,e)=>{const s=t.messages.length?new Date(t.messages[t.messages.length-1].time):new Date(0);return(e.messages.length?new Date(e.messages[e.messages.length-1].time):new Date(0))-s})}const I=document.querySelector(".chatlist");C();J();u();function u(){I.innerHTML="",c.chats.forEach(e=>{const s=E(e);I.appendChild(s)}),document.querySelectorAll(".delete-chat").forEach(e=>{e.addEventListener("click",s=>{s.stopPropagation();const a=parseInt(e.getAttribute("data-chat-id"));U(a)})})}function U(t){c.chats=c.chats.filter(e=>e.chatId!==t),r(),u()}u();r();const h=document.getElementById("messageBox"),F=document.querySelector(".chatBox"),R=document.querySelector("#back"),Y=document.querySelector("#send-btn"),f=document.querySelector("#messageInput");let y="right";function x(){const t=f.value.trim();if(t&&d!==null){const e=z(t);if(e&&d!==null){const s={type:y==="right"?"outgoing":"incoming",from:y,content:e,time:new Date().toISOString()},a=c.chats.find(n=>n.chatId===d);if(a){a.messages.push(s);const n=document.createElement("div");n.classList.add("message","outgoing");const o=new Date(s.time).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"});n.innerHTML=`<p>${e}</p><span class="time">${o}</span>`,h.appendChild(n),h.scrollTop=h.scrollHeight,f.value="",r()}}}}Y.addEventListener("click",x);f.addEventListener("keydown",t=>{t.key==="Enter"&&(t.preventDefault(),x())});R.addEventListener("click",()=>{F.classList.add("hide"),u()});const _=document.getElementById("toggleAlignment");let p=!0;function j(){document.querySelectorAll(".message").forEach(e=>{e.classList.contains("incoming")?(e.classList.remove("incoming"),e.classList.add("outgoing"),e.style.textAlign="right",e.style.marginLeft="auto",e.style.marginRight="unset"):e.classList.contains("outgoing")&&(e.classList.remove("outgoing"),e.classList.add("incoming"),e.style.textAlign="left",e.style.marginRight="auto",e.style.marginLeft="unset")}),y=p?"left":"right",p=!p}_.addEventListener("click",j);function z(t){return t.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#039;")}

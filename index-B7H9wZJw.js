(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))a(n);new MutationObserver(n=>{for(const o of n)if(o.type==="childList")for(const i of o.addedNodes)i.tagName==="LINK"&&i.rel==="modulepreload"&&a(i)}).observe(document,{childList:!0,subtree:!0});function s(n){const o={};return n.integrity&&(o.integrity=n.integrity),n.referrerPolicy&&(o.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?o.credentials="include":n.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function a(n){if(n.ep)return;n.ep=!0;const o=s(n);fetch(n.href,o)}})();const A=document.querySelector(".chatBox"),l=document.querySelector("#chatAvatar"),v=document.querySelector("#chatName"),S=document.getElementById("messageBox");let d=null;function f(t){const e=document.createElement("div");e.classList.add("block");const s=t.participants[0].charAt(0).toUpperCase(),a=t.messages.length?B(t.messages[t.messages.length-1].time):"",n=t.messages.length?t.messages[t.messages.length-1].content:"Нет сообщений",o='<span class="material-icons read-icon" style="margin-left: 5px;">done_all</span>';return e.innerHTML=`
      <div class="imgBx">
        <img 
          id="chatAvatar${t.chatId}" 
          src="${t.chatId}.png" 
          alt="Chat avatar" 
          onerror="this.style.display='none'; this.nextElementSibling.style.display='flex';" 
        />
        <div class="avatarLetter" style="display: none; justify-content: center; align-items: center; font-size: 24px; width: 40px; height: 40px; border-radius: 50%; background-color: #8f9efe;">
          ${s}
        </div>
      </div>
      <div class="details">
        <div class="listHead">
          <h4>${t.participants[0]}</h4>
          <div class="time-delete-wrapper">
            <span class="material-symbols-outlined delete-chat" data-chat-id="${t.chatId}">delete</span> <!-- Иконка удаления -->
            <p class="time">${a}</p>
          </div>
        </div>
        <div class="message_p" style="display: flex; justify-content: space-between; align-items: center;">
          <p>${n}</p>
          ${o}
        </div>
      </div>`,e.addEventListener("click",()=>$(t)),e}function D(t,e,s){const a=`${t}.png`,n=s.innerHTML.charAt(0).toUpperCase();e.src=a,e.onload=()=>{e.style.display="block",e.nextElementSibling.style.display="none"},e.onerror=()=>{e.style.display="none";const o=e.nextElementSibling;o.style.display="flex",o.innerHTML=n}}function $(t){A.classList.remove("hide"),S.innerHTML="",d=t.chatId,v.innerHTML=`${t.participants[0]} <br /><span>online</span>`;const e=t.participants[0].charAt(0).toUpperCase();D(t.chatId,l,v),l.onerror=()=>{l.nextElementSibling.style.display="flex",l.nextElementSibling.innerHTML=e},t.messages.forEach(s=>{const a=document.createElement("div");s.type==="incoming"?a.classList.add("message","incoming"):s.type==="outgoing"&&a.classList.add("message","outgoing");const n=B(s.time);a.innerHTML=`
      <p>${s.content}</p>
      <div class="message-footer">
        <span class="time">${n}</span>
        <span class="material-icons read-icon">done_all</span> <!-- Иконка прочтения -->
      </div>
    `,S.appendChild(a)})}function B(t){return new Date(t).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})}const c={chats:[{chatId:1,participants:["You","right"],messages:[{type:"incoming",from:"You",content:"Hey, how's it going?",time:"2024-10-15T10:00"},{type:"outgoing",from:"right",content:"All good, thanks! How about you?",time:"2024-10-15T10:05"},{type:"incoming",from:"You",content:"I'm doing well, thanks for asking!",time:"2024-10-15T10:10"}]},{chatId:2,participants:["Jane Smith","right"],messages:[{type:"outgoing",from:"right",content:"Hey Jane, let's catch up soon!",time:"2024-10-15T12:30"},{type:"incoming",from:"Jane Smith",content:"Sure! How about tomorrow?",time:"2024-10-15T12:35"},{type:"outgoing",from:"right",content:"Sounds good. Let's meet at 10 AM.",time:"2024-10-15T12:40"}]}]};function r(){try{localStorage.setItem("chatData",JSON.stringify(c)),console.log("Чаты успешно сохранены в localStorage.")}catch(t){console.error("Ошибка при сохранении чатов в localStorage:",t)}}function C(){try{const t=localStorage.getItem("chatData");t&&(c.chats=JSON.parse(t).chats),console.log("Чаты успешно загружены из localStorage.")}catch(t){console.error("Ошибка при загрузке чатов из localStorage:",t)}}function k(){c.chats.sort((t,e)=>{const s=t.messages.length?new Date(t.messages[t.messages.length-1].time):new Date(0);return(e.messages.length?new Date(e.messages[e.messages.length-1].time):new Date(0))-s})}const I=document.querySelector(".chatlist");C();k();y();function y(){I.innerHTML="",c.chats.forEach(e=>{const s=f(e);I.appendChild(s)}),document.querySelectorAll(".delete-chat").forEach(e=>{e.addEventListener("click",s=>{s.stopPropagation();const a=parseInt(e.getAttribute("data-chat-id"));H(a)})})}function H(t){c.chats=c.chats.filter(e=>e.chatId!==t),r(),y()}y();r();document.addEventListener("DOMContentLoaded",()=>{const t=document.querySelector(".material-symbols-outlined"),e=document.querySelector("#searchInput"),s=document.querySelectorAll(".chatlist .block");function a(){t.classList.add("hide"),e.classList.add("active"),e.focus()}function n(){const o=e.value.toLowerCase();s.forEach(i=>{const x=i.querySelector(".listHead h4").innerText.toLowerCase();i.style.display=x.includes(o)?"":"none"})}t.addEventListener("click",a),e.addEventListener("input",n),e.addEventListener("blur",()=>{e.value===""&&(t.classList.remove("hide"),e.classList.remove("active"))}),e.addEventListener("focus",()=>{t.classList.add("hide")})});const L=document.getElementById("chatNameInput"),q=document.getElementById("createChatButton"),M=document.getElementById("chatModal"),N=document.querySelector(".chatlist");function T(){let t=L.value.trim();if(t!==""){t=J(t);const e=new Date;new Intl.DateTimeFormat("ru-RU",{timeZone:"Europe/Moscow",hour:"2-digit",minute:"2-digit"}).format(e);const s={chatId:c.chats.length+1,participants:[t,"right"],messages:[]};c.chats.unshift(s),r();const a=f(s);a.classList.add("chat-animate"),N.prepend(a),setTimeout(()=>{a.classList.remove("chat-animate")},500),w()}}q.addEventListener("click",T);const O=document.getElementById("modalClose");function P(){M.classList.add("active")}function w(){L.value="",M.classList.remove("active")}O.addEventListener("click",w);document.getElementById("openModalButton").addEventListener("click",P);function J(t){return t.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#039;")}L.addEventListener("keypress",t=>{t.key==="Enter"&&T()});function U(){c.chats.sort((t,e)=>{const s=t.messages.length?new Date(t.messages[t.messages.length-1].time):new Date(0);return(e.messages.length?new Date(e.messages[e.messages.length-1].time):new Date(0))-s})}const E=document.querySelector(".chatlist");C();U();g();function g(){E.innerHTML="",c.chats.forEach(e=>{const s=f(e);E.appendChild(s)}),document.querySelectorAll(".delete-chat").forEach(e=>{e.addEventListener("click",s=>{s.stopPropagation();const a=parseInt(e.getAttribute("data-chat-id"));F(a)})})}function F(t){c.chats=c.chats.filter(e=>e.chatId!==t),r(),g()}g();r();const m=document.getElementById("messageBox"),R=document.querySelector(".chatBox"),Y=document.querySelector("#back"),_=document.querySelector("#send-btn"),h=document.querySelector("#messageInput");let p="right";function b(){const t=h.value.trim();if(t&&d!==null){const e=K(t);if(e&&d!==null){const s={type:p==="right"?"outgoing":"incoming",from:p,content:e,time:new Date().toISOString()},a=c.chats.find(n=>n.chatId===d);if(a){a.messages.push(s);const n=document.createElement("div");n.classList.add("message","outgoing","bubble-animation");const o=new Date(s.time).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"});n.innerHTML=`<p>${e}</p><span class="time">${o}</span>`,m.appendChild(n),m.scrollTop=m.scrollHeight,h.value="",r(),setTimeout(()=>{n.classList.remove("bubble-animation")},500)}}}}_.addEventListener("click",b);h.addEventListener("keydown",t=>{t.key==="Enter"&&(t.preventDefault(),b())});Y.addEventListener("click",()=>{R.classList.add("hide"),g()});const j=document.getElementById("toggleAlignment");let u=!0;function z(){document.querySelectorAll(".message").forEach(e=>{e.classList.contains("incoming")?(e.classList.remove("incoming"),e.classList.add("outgoing"),e.style.textAlign="right",e.style.marginLeft="auto",e.style.marginRight="unset"):e.classList.contains("outgoing")&&(e.classList.remove("outgoing"),e.classList.add("incoming"),e.style.textAlign="left",e.style.marginRight="auto",e.style.marginLeft="unset")}),p=u?"left":"right",u=!u}j.addEventListener("click",z);function K(t){return t.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#039;")}
